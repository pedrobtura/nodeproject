<%- include("partials/_header") %>

    <div class="container mt-5">
        <div class="row">
            <div class="col md-7">
                <table class="table table-dark table-bordered table-hover">
                    <thead>
                        <tr>
                            <td>nÂ°</td>
                            <td>Name</td>
                            <td>Address</td>
                            <td>Phone</td>
                            <td>Actions</td>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (data) { %>
                            <% for(var i=0; i < data.length; i++) { %>
                                <tr>
                                    <td>
                                        <%= (i + 1) %>
                                    </td>
                                    <td>
                                        <%= data[i].name %>
                                    </td>
                                    <td>
                                        <%= data[i].address %>
                                    </td>
                                    <td>
                                        <%= data[i].phone %>
                                    </td>
                                    <td class="d-flex gap-2">
                                        <a href="/delete/<%= data[i].id %>" class="btn btn-danger"> Delete</a>
                                    </td>
                                    <td class="d-flex gap-2">
                                        <a href="#" data-id="<%= data[i].id %>"
                                            class="btn btn-success btn-update">Actualizar</a>
                                    </td>
                                </tr>
                                <% } %>
                                    <% } %>
                    </tbody>
                </table>

            </div>
            <div class="col md-5">
                <form action="/add" method="POST">
                    <input type="text" name="name" placeholder="Name" class="form-control mb-2" autofocus />
                    <input type="email" name="address" placeholder="Address" class="form-control mb-2" />
                    <input type="text" name="phone" placeholder="Phone" class="form-control mb-2" />
                    <button type="submit" class="btn btn-info">Save customer</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll(".btn-update").forEach((button) => {
            button.addEventListener("click", function (event) {
                event.preventDefault()
                const id = this.dataset.id
                editCustomer(id)
            })
        })
        function editCustomer(id) {
            event.preventDefault();

            fetch(`/api/customers/${id}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(Error `al obtener los datos del cliente: ${ response.status }`);
                    }
                    return response.json();
                })
                .then((customer) => {
                    document.querySelector('input[name="name"]').value = customer.name;
                    document.querySelector('input[name="address"]').value = customer.address;
                    document.querySelector('input[name="phone"]').value = customer.phone;


                    const submitButton = document.querySelector('button[type="submit"]');
                    submitButton.textContent = "Actualizar";
                    submitButton.classList.add("btn-dark");
                    submitButton.classList.remove("btn-warning");

                    document.querySelector('form').action = `/update/${ id }`;
                })
                .catch((error) => {
                    console.error(error);
                    alert("No se pudieron cargar los datos del cliente.");
                });
        }
    </script>

    <%- include("partials/_footer") %>